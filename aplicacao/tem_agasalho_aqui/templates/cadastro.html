<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro - Agasalho Aqui</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <div class="container header-container">
            <a href="/">
                <img src="/static/images/Logotipo.png" alt="Logo Agasalho Aqui" class="logo">
            </a>
            <nav class="nav-menu">
                <a href="/">Home</a>
                <a href="/sobre">Sobre</a>
                <a href="/pontosdecoleta">Pontos de Coleta</a>
                <a href="/cadastro">Cadastro</a>
                <a href="/administracao">Administração</a>
            </nav>
        </div>
    </header>

{% if is_logged_in %}
<div class="logout-button-container">
    <a href="/admin/logout" class="logout-button">
        <span class="logout-icon">⎋</span> Sair
    </a>
</div>
{% endif %}

<main>
        <div class="container">
            <h1 class="page-title">CADASTRO</h1>
            
            <div class="form-container">
                <p class="form-description">Quer ser divulgado em nossa plataforma como ponto de coleta? Cadastre-se abaixo</p>
                <br>
                
                <form id="cadastro-form">

<div class="form-group">
    <label for="nome">Nome da Instituição*</label>
    <input type="text" id="nome" name="nome" class="form-control" required>
</div>

<div class="form-group">
    <label for="email">E-mail*</label>
    <input type="email" id="email" name="email" class="form-control" required placeholder="email@exemplo.com.br">
</div>

<div class="form-group">
    <label for="telefone">Telefone*</label>
    <input type="tel" id="telefone" name="telefone" class="form-control" required placeholder="11 91234-5678">
</div>

<!-- Novo campo CEP com botão de busca -->
<div class="form-row">
    <div class="form-group col-md-4">
        <label for="cep">CEP*</label>
        
        <div class="input-group">
            <input type="text" id="cep" name="cep" class="form-control" maxlength="9" required>
            <div class="input-group-append">
                <button type="button" class="nav-button" id="buscar-cep">Buscar</button>
            </div>
        </div>
        
        <!--<small class="form-text text-muted">Digite o CEP</small> -->
    </div>
</div>

<!-- Campo de endereço existente, agora com preenchimento automático -->
<div class="form-group">
    <label for="endereco">Logradouro*</label>
    <input type="text" id="endereco" name="endereco" class="form-control" required>
</div>

<!-- Novos campos para complemento de endereço -->
<div class="form-row">
    <div class="form-group col-md-2">
        <label for="numero">Número*</label>
        <input type="text" id="numero" name="numero" class="form-control" required>
    </div>
    <div class="form-group col-md-10">
        <label for="bairro">Bairro*</label>
        <input type="text" id="bairro" name="bairro" class="form-control" required>
    </div>
</div>

<div class="form-row">
    <div class="form-group col-md-8">
        <label for="cidade">Cidade*</label>
        <input type="text" id="cidade" name="cidade" class="form-control" required>
    </div>
    <div class="form-group col-md-4">
        <label for="uf">UF*</label>
        <select id="uf" name="uf" class="form-control" required>
            <option value="">Selecione...</option>
            <option value="AC">Acre</option>
            <option value="AL">Alagoas</option>
            <option value="AP">Amapá</option>
            <option value="AM">Amazonas</option>
            <option value="BA">Bahia</option>
            <option value="CE">Ceará</option>
            <option value="DF">Distrito Federal</option>
            <option value="ES">Espírito Santo</option>
            <option value="GO">Goiás</option>
            <option value="MA">Maranhão</option>
            <option value="MT">Mato Grosso</option>
            <option value="MS">Mato Grosso do Sul</option>
            <option value="MG">Minas Gerais</option>
            <option value="PA">Pará</option>
            <option value="PB">Paraíba</option>
            <option value="PR">Paraná</option>
            <option value="PE">Pernambuco</option>
            <option value="PI">Piauí</option>
            <option value="RJ">Rio de Janeiro</option>
            <option value="RN">Rio Grande do Norte</option>
            <option value="RS">Rio Grande do Sul</option>
            <option value="RO">Rondônia</option>
            <option value="RR">Roraima</option>
            <option value="SC">Santa Catarina</option>
            <option value="SP">São Paulo</option>
            <option value="SE">Sergipe</option>
            <option value="TO">Tocantins</option>
        </select>

    <!-- Substituir a seção dos campos horário e site -->

</div>
</div>
<!-- Fechamento correto da div form-row anterior -->

<!-- Campo de horário em sua própria linha -->
<div class="form-group">
    <label for="horario">Horário de Funcionamento*</label>
    <input type="text" id="horario" name="horario" class="form-control" required placeholder="Ex: Segunda a Sexta, 9h às 18h">
</div>

<!-- Campo de site em sua própria linha -->
<div class="form-group">
    <label for="site">Site (opcional)</label>
    <input type="url" id="site" name="site" class="form-control" placeholder="https://www.exemplo.com.br">
</div>

<div id="message" class="alert" style="display: none;"></div>

<button type="submit" class="submit-button">ENVIAR SOLICITAÇÃO</button>
    
    </form>
</div>
    </main>

    <footer>
        <div class="container footer-container">
            <img src="/static/images/HeartBoxlogo.png" alt="Logo Agasalho Aqui" class="footer-logo">
            <div class="contact-info">
                <h3>Fale conosco</h3>
                <p><a href="mailto:agasalhoaqui@gmail.com">agasalhoaqui@gmail.com</a></p>
                <p>(11) 4002-0922</p>
            </div>
            <div class="footer-links">
                <a href="/termos">Termos e Condições</a> | 
                <a href="/privacidade">Políticas de Privacidade</a>
            </div>
            <p class="copyright">© Tem Agasalho Aqui LTDA - Todos os direitos reservados</p>
        </div>
    </footer>

    <script src="/static/js/scripts.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const cepInput = document.getElementById('cep');
            const buscarCepBtn = document.getElementById('buscar-cep');
            
            // Máscara para o CEP
            cepInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, ''); // Remove não-números
                if (value.length > 8) value = value.substring(0, 8);
                if (value.length > 5) {
                    value = value.substring(0, 5) + '-' + value.substring(5);
                }
                e.target.value = value;
            });
            
            // Buscar CEP ao sair do campo
            cepInput.addEventListener('blur', function() {
                if (this.value.length >= 8) {
                    buscarCEP();
                }
            });
            
            // Buscar CEP ao clicar no botão
            buscarCepBtn.addEventListener('click', buscarCEP);
            
            function buscarCEP() {
                const cep = cepInput.value.replace(/\D/g, '');
                if (cep.length !== 8) {
                    alert('CEP inválido. Digite um CEP com 8 dígitos.');
                    return;
                }
                
                // Mostrar indicador de carregamento
                const loadingState = document.createElement('div');
                loadingState.className = 'loading-indicator';
                loadingState.textContent = 'Buscando endereço...';
                cepInput.parentNode.appendChild(loadingState);
                
                // Desabilitar campos durante a busca
                setFieldsDisabled(true);
                
                // Realizar a consulta na API ViaCEP
                fetch(`https://viacep.com.br/ws/${cep}/json/`)
                    .then(response => {
                        if (!response.ok) throw new Error('Erro ao buscar CEP');
                        return response.json();
                    })
                    .then(data => {
                        // Remover indicador de carregamento
                        if (loadingState.parentNode) {
                            loadingState.parentNode.removeChild(loadingState);
                        }
                        
                        // Verificar se o CEP foi encontrado
                        if (data.erro) {
                            alert('CEP não encontrado. Verifique o número digitado.');
                            setFieldsDisabled(false);
                            return;
                        }
                        
                        // Preencher os campos com os dados retornados
                        document.getElementById('endereco').value = data.logradouro;
                        document.getElementById('bairro').value = data.bairro;
                        document.getElementById('cidade').value = data.localidade;
                        document.getElementById('uf').value = data.uf;
                        
                        // Focar no campo número
                        document.getElementById('numero').focus();
                        
                        // Reativar os campos
                        setFieldsDisabled(false);
                    })
                    .catch(error => {
                        console.error('Erro:', error);
                        alert('Erro ao buscar o CEP. Por favor, tente novamente ou preencha manualmente.');
                        setFieldsDisabled(false);
                        
                        // Remover indicador de carregamento
                        if (loadingState.parentNode) {
                            loadingState.parentNode.removeChild(loadingState);
                        }
                    });
            }
            
            function setFieldsDisabled(disabled) {
                document.getElementById('endereco').disabled = disabled;
                document.getElementById('bairro').disabled = disabled;
                document.getElementById('cidade').disabled = disabled;
                document.getElementById('uf').disabled = disabled;
            }
        });
        </script>

        <script>
    // Script para limpar o formulário quando a página é carregada ou atualizada
    document.addEventListener('DOMContentLoaded', function() {
        // Limpar o formulário ao carregar a página
        const cadastroForm = document.getElementById('cadastro-form');
        if (cadastroForm) {
            cadastroForm.reset();
        }
        
        // Adicionar um evento para limpar o formulário antes de atualizar a página
        window.addEventListener('beforeunload', function() {
            if (cadastroForm) {
                // Armazenar temporariamente que a página está sendo recarregada
                sessionStorage.setItem('formReloading', 'true');
                // O navegador limpa automaticamente os campos ao atualizar,
                // mas podemos garantir isso com:
                cadastroForm.reset();
            }
        });
        
        // Verificar se estamos recarregando a página e limpar o formulário novamente
        if (sessionStorage.getItem('formReloading')) {
            sessionStorage.removeItem('formReloading');
            if (cadastroForm) {
                cadastroForm.reset();
                
                // Limpar também campos preenchidos automaticamente pelo navegador
                setTimeout(function() {
                    const inputs = cadastroForm.querySelectorAll('input, select, textarea');
                    inputs.forEach(function(input) {
                        input.value = '';
                    });
                    // Restaurar o select UF para a opção padrão
                    const ufSelect = document.getElementById('uf');
                    if (ufSelect) {
                        ufSelect.value = '';
                    }
                }, 100);
            }
        }
    });
</script>

</body>
</html>
